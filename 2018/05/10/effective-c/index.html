<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="effective_c," />










<meta name="description" content="from effective c++ 理解Ｃ＋＋(1) c++是一个语言联邦 C Object-oriented c++ Template c++ STL">
<meta name="keywords" content="effective_c">
<meta property="og:type" content="article">
<meta property="og:title" content="effective c++">
<meta property="og:url" content="http://yoursite.com/2018/05/10/effective-c/index.html">
<meta property="og:site_name" content="Winuzz">
<meta property="og:description" content="from effective c++ 理解Ｃ＋＋(1) c++是一个语言联邦 C Object-oriented c++ Template c++ STL">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/images/effective-c/strategy.png">
<meta property="og:image" content="http://yoursite.com/images/effective-c/new-handler.png">
<meta property="og:updated_time" content="2018-07-25T08:54:01.020Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="effective c++">
<meta name="twitter:description" content="from effective c++ 理解Ｃ＋＋(1) c++是一个语言联邦 C Object-oriented c++ Template c++ STL">
<meta name="twitter:image" content="http://yoursite.com/images/effective-c/strategy.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/10/effective-c/"/>





  <title>effective c++ | Winuzz</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Winuzz</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">stay hungry stay foolish</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/10/effective-c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zz_wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Winuzz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">effective c++</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-10T10:16:05+08:00">
                2018-05-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/program-language/" itemprop="url" rel="index">
                    <span itemprop="name">program_language</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>from effective c++</p>
<h2 id="理解C＋＋"><a href="#理解C＋＋" class="headerlink" title="理解Ｃ＋＋"></a>理解Ｃ＋＋</h2><p>(1) c++是一个语言联邦 C Object-oriented c++ Template c++ STL</p>
<a id="more"></a>
<p>(2) 尽量使用const enum inline 替换 #define 宁可以编译器替换预处理器</p>
<p>#define RATIO 1.653<br>宏定义的常量标记RATIO 没有进入记号表 盲目使用宏定义会使得目标码出现多份 1.653</p>
<p>宏定义无法定义class专属常量</p>
<p>形似函数宏定义容易出错</p>
<p>单纯常量 使用const或enum 替换 #define<br>形似函数 使用inline替换#define</p>
<p>(3) 尽可能使用const</p>
<p>顶层const 底层const</p>
<p>星号左边 被指物是常量 星号右边 指针本身是常量</p>
<p>某些东西被声明为const可以帮助编译器侦测出错误用法 const可被任何作用域的对象 函数参数 函数返回类型 成员函数本体</p>
<p>编译器强制实施 bitwise constness .编写程序时应该使用“概念上的常量性” 即 const成员函数不能更改对象中任何non-static成员变量</p>
<p>mutable能释放掉non-static成员变量的bitwise constness</p>
<p>当const和non-const成员函数有着实质等价实现时 令non-const版本调用const版本能够避免重复代码 使用转型(const_cast&lt;&gt; static_cast&lt;&gt;)</p>
<p>(4) 确定对象使用前已被初始化</p>
<p>c++规定对象成员变量的初始化动作发生在进入构造函数本体之前 可以使用成员初始列</p>
<p>调用一次copy构造函数 比一个构造和一个copy赋值高效</p>
<p>c++ 有十分固定的“成员初始化次序” 和定义次序一致</p>
<p>函数内static对象被称为 local static 对象 其他被称为 non-local static 对象 程序结束时static会被自动销毁 也就是它们的析构函数在main函数结束时被自动调用</p>
<p>c++对不同编译单元内的non local static对象 的初始化次序并未明确定义 将non-local static对象搬到自己的专属函数内（单例模式）　non-local static 被 local　static 对象替换</p>
<h2 id="构造-析构-赋值运算"><a href="#构造-析构-赋值运算" class="headerlink" title="构造　析构　赋值运算"></a>构造　析构　赋值运算</h2><p>(5) 了解c++调用哪些函数 默认构造函数 拷贝构造 赋值 析构函数</p>
<p>定义reference或const变量 没有定义赋值操作 c++的响应是拒绝编译那一行的赋值动作。</p>
<p>(6) 若不想使用编译器自动生成的函数 明确拒绝： 将相应的成员函数声明为private并不予实现。</p>
<p>(7) 为多态基类声明virtual析构函数</p>
<p>基类指针指向派生类 删除基类指针 “局部销毁” 派生类自身内容未被删除 造成内存泄漏</p>
<p>classes的设计不是作为基类使用 不应该声明virtual析构函数</p>
<p>(8) 别让异常逃离析构函数</p>
<p>假设vector中存了多个对象 对象能够在析构函数中抛出异常 当调用这些对象析构函数 出现多个异常 会使得程序终止或产生未定义的行为</p>
<p>析构函数调用的函数可能出现异常 那么析构函数应该捕捉异常 吞下它或终止程序</p>
<p>如果客户需要对某个操作函数运行时抛出的异常做出反应 那么class应该提供一个普通的函数（非析构函数）执行该操作。</p>
<p>(9) 在构造和析构期间不要调用virtual函数</p>
<p>(10) 令 赋值操作（operator=） 返回一个 reference to *this</p>
<p>(11) 在operator= 中处理“自我赋值”</p>
<p>确保对象自我赋值时operator= 有良好的行为。 其中包括比较“来源对象” 和目标对象的地址、 精心周到的语句顺序 、 copy and swap</p>
<pre><code>class Bitmap{};
class Widget{
public:...
private:
    Bitmap *pb;};
</code></pre><p>证同测试</p>
<pre><code>Widget &amp; Widget::operator =(const Widget&amp; rhs){
  if(this == &amp;rhs) return *this;
  delete pb;
  pb = new Bitmap(*rhs.pb);
return *this;}
</code></pre><p>精心周到的语句顺序</p>
<pre><code>Widget &amp; Widget::operator =(const Widget&amp; rhs){
  Bitmap *orign_pb = pb;
  pb = new Bitmap(*rhs.pb);   // 为 rhs 创造一份副本
  delete orign_pb;
return *this;}
</code></pre><p>copy and swap</p>
<pre><code>Widget &amp; Widget::operator =(const Widget&amp; rhs){
  Widget temp(rhs);    
  swap(temp);
  return *this;}
</code></pre><p>(12) 赋值对象时勿忘其每一个成分</p>
<p>copy函数应该确保 复制所有的local变量， 在定义derived class定义copy函数时 调用适当的base class 中的copy函数</p>
<h2 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h2><p>(13) 以对象管理资源    </p>
<p>获得资源后立即放入对象管理<br>管理资源的对象通过折构函数确保资源的释放<br>auto_ptr 能实现动态分配对象的自动释放 要求其对裸指针的完全占有性  但另一个auto_ptr进行复制拷贝时 其失去所有权 为null<br>shared_ptr 智能指针 允许复制拷贝 引用计数</p>
<p>（14）在资源管理类中小心copy行为</p>
<p>面对不合理的资源复制行为： 禁止复制 使用shared_ptr引用计数</p>
<p>（15）在资源管理类中提供对原始资源的访问</p>
<p>get方法提供显示转换 安全<br>operator 类型名 隐式转换</p>
<p>（16） 成对使用new和delete时 采用相同形式<br>new 使用[] delete也使用[]<br>new 不使用 delete也不使用</p>
<p>(17)以独立语句将新创建的资源对象置入智能指针</p>
<p>防止在创建资源和置入智能指针的时间点之间产生异常<br>造成资源泄漏</p>
<h2 id="设计与声明"><a href="#设计与声明" class="headerlink" title="设计与声明"></a>设计与声明</h2><p>(18) 接口容易被正确使用 不易被误用</p>
<p>促进正确使用包括接口一致性 内置类型的行为兼容<br>阻止误用 消除客户的资源管理责任<br>使用shared_ptr 支持定制的删除器</p>
<p>(19) 像type一样设计class<br>设计class需要注意的地方：<br>创建和销毁<br>对象的初始化和赋值之间的区别<br>copy构造函数定义值传递<br>合法的新type对象<br>继承体系<br>类型转换 隐式转换 显式转换<br>操作符和函数对新type式合理的<br>什么样的标准函数应该驳回<br>谁使用新type的成员 private public的定义<br>未声明接口<br>一般化 template<br>这个新的type的需求是确切的吗？</p>
<p>(20) 使用pass-by-reference-to-const 替换 pass-by-value<br> 使用pass-by-reference-to-const 替换 pass-by-value 更高效 避免切割问题<br> 对于内置类型 如stl的迭代器和函数对象 pass-by-value比较合适</p>
<p> (21)该返回对象时返回对象</p>
<p> 返回局部对象的引用或指针 因为原来对象已经销毁 会产生未知错误</p>
<p> 标准做法：</p>
<pre><code>const Rational operator *(Rational &amp;lhs, Rational &amp;rhs) {
   return Rational(lhs.numerator()* rhs.numerator(), lhs.denominator()*rhs.denominator());}
</code></pre><p><strong>函数返回局部对象时做的操作</strong></p>
<p>函数的局部对象在当前函数被调用的时候创建，存储在栈区，在函数结束以后就会被释放，如果存在返回值，那么当前对象也会被释放，只不过在被释放前做了一次拷贝，拷贝到接受该返回值的另外一个对象上面，所以函数的入参和返回值其实都进行的是拷贝操作，新的对象被赋值，旧的的对象被回收</p>
<p>（22）成员变量声明为private<br>private有很好的封装性 允许class作者有功能实现的弹性，保证客户访问数据的一致性<br>protected并不比public更具有封装性</p>
<p>(23) 使用non-member non-friend函数替换member函数<br>提供原始操作来的类 如浏览器类中的清除浏览器功能 包括清除缓存 历史记录等 这个功能不应该内置 由工具类提供更为合适</p>
<p>（24）为某个函数的所有参数提供类型转换 这个函数是个non-member<br>如 Rational的乘法操作</p>
<pre><code>const Rational operator *(Rational &amp;lhs, Rational &amp;rhs) {
   return Rational(lhs.numerator()* rhs.numerator(), lhs.denominator()*rhs.denominator());}
</code></pre><p>比 member方法</p>
<pre><code>const Rational operator *(const Rational &amp;rhs) const{...}
</code></pre><p>更为合适</p>
<p>（25） swap函数注意事项<br>std:swap效率不高时 提供一个swap成员函数 确保不抛出异常<br>如何提供一个member函数 也该提供一个non-member swap调用前者<br>调用std::swap时 使用using声明</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>(26) 延后变量定义式的出现 在需要使用变量时再定义。</p>
<p>(27) 尽量少做转型<br>const_cast<t>(expression) 对象常量的消除</t></p>
<p>dynamic_cast<t>(expression) “安全向下转型”<br>类层次结构中父类和子类之间指针和引用的转换</t></p>
<p>reinterpret_cast<t>(expression) 执行低级转型 将pointer to int 转型为 int</t></p>
<p>static_cast<t>(expression) 强迫隐式转换 non-const对象转换为const对象 int为double , pointer-to-base 转换为pointer-to-derived 用于基本数据类型之间的转换，把空指针转换成目标类型的空指针,把任何类型的表达式类型转换成void类型，用于类层次结构中父类和子类之间指针和引用的转换。</t></p>
<p>另外，C++中层次类型转换中无非两种：上行转换和下行转换</p>
<pre><code>Base *P = new Derived();
Derived *pd1 = static_cast&lt;Derived *&gt;(P);
Derived *pd2 = dynamic_cast&lt;Derived *&gt;(P);
</code></pre><p>static_cast和dynamic_cast都能正确执行</p>
<pre><code>Base *P = new Base;
Derived *pd3 = static_cast&lt;Derived *&gt;(P);
Derived *pd4 = dynamic_cast&lt;Derived *&gt;(P);
</code></pre><p>static_cast能够执行成功 不安全 dynamic_cast在运行时类型检查 转换不合理 返回NULL</p>
<p>explicit关键字用来修饰类的构造函数，被修饰的构造函数的类，不能发生相应的隐式类型转换，只能以显示的方式进行类型转换。</p>
<p>避免转型 若pointer-to-base 指向derived时 需要使用derived的方法 可以替换的方案是 直接使用pointer-to-derived或在base类中定义virutal方法<br>使用新式转型</p>
<p>(28) 避免返回handles(包括references 指针 迭代器)指向对象内部 封装性 防止用户修改对象内部数据或产生未知错误</p>
<p>(29) 异常安全函数 即使发生异常亦不会泄露资源或允许任何数据结构的败坏</p>
<p>(30)理解inline</p>
<p>inline函数 以函数本体替换 程序体积大 额外的换页行为<br>inlining 是编译期行为</p>
<p>inline函数限制在小型 频繁调用的函数身上<br>不要应为 function templates出现在头文件 就将它们声明为inline</p>
<p>(31) 编译依存性最小化：相依于声明式 不要相依于定义式<br>两个手段 handles classes 和 interface </p>
<h2 id="继承与面向对象设计"><a href="#继承与面向对象设计" class="headerlink" title="继承与面向对象设计"></a>继承与面向对象设计</h2><p>(32) public 继承关系应该是 is-a 关系</p>
<p>(33) 避免遮蔽继承而来的名称<br>derived classes内的名称会遮蔽 base classes内的名称<br>为了遮蔽名称再见天日 使用using声明式</p>
<p>(34) 区分接口继承和实现继承</p>
<p>具有纯虚函数的类时接口</p>
<p>纯虚函数只指定接口继承 derived类中需提供纯虚函数的实现 另外 通过base类名::纯虚函数方法 可以提供纯虚函数的缺省实现</p>
<p>非纯虚函数具体制定接口继承和缺省实现继承 若derived不重新定义 可以使用base的缺省实现</p>
<p>非虚函数制定接口继承和强制性实现继承</p>
<p>(35) 考虑virtual函数以外的其他选择</p>
<p>在classes定义内呈现成员函数的本体 就让它们暗自成了inline</p>
<p>通过public的非虚函数 调用private的虚函数 称为non-virtual-interface(nvi)手法  非虚函数称为虚函数的外覆盖器<br>能够在调用虚函数之前或之后做一些操作</p>
<p>使用nvi手法替换虚函数</p>
<p>strategy设计模式 使用函数指针变量替换虚函数 使用trl::function成员变量替换虚函数 继承体系中的虚函数替换为另一个继承体系内的虚函数</p>
<p>函数指针示例：</p>
<pre><code>class GameCharater;
int defaultHealthCalc(const GameCharacter &amp; gc);
class GameCharacter{
public:
    typedef std::trl::function&lt;int (const GameCharacter&amp;)&gt; HealthCalcFunc;
    explicit GameCharacter(HealthCalcFunc hcf=defaultHealthCalc):healthFunc(hcf);
    int healthValue() const
    {
        return healthFunc(*this);
    }
private:
    HealthCalcFunc healthFunc;
}
</code></pre><p>传统strategy设计模式</p>
<p><img src="/images/effective-c/strategy.png" alt=""></p>
<p>(36)  绝对不要重新定义继承而来的非虚函数</p>
<p>(37) 绝对不要重新定义继承而来的缺省参数值<br>虚函数时动态绑定的 而缺省参数值却是静态绑定的 运行效率问题<br>使用nvi方法解决 </p>
<p>(38) 复合关系与继承不同  意味着 has-a或 is-implemented-in-terms-of(根据某物实现)</p>
<p>(39) 明智而审慎地使用private继承</p>
<p>sizeof(空对象) 结果为1 c++官方勒令安插一个char到空对象内 字节对齐 不一定为1 </p>
<p>private继承意味着 is-implemented-in-terms if。通常使用复合更合适。但derived需要访问 protected base的成员或重新定义virutal函数时 ，这种设计是合理的。</p>
<p>private继承可以造成empty base 最优化。</p>
<p>(40) 明智而审慎地使用多重继承</p>
<p>多重继承的父类有相同的函数 容易造成歧义 需要使用virtual继承</p>
<p>vitual继承增加大小 速度 初始化等成本。virtual base classes不带任何数据是比较好的选择</p>
<p>使用public继承某个接口 使用private继承某个协助实现的class，可以使用多重继承。</p>
<p>模板与泛型编程</p>
<p>(41) template 编译期多态</p>
<p>(42) 理解typename</p>
<p>在模板中表示类型参数时 typename与class 一致</p>
<p>在模板中涉及到嵌套从属类型名时  需要在它的前一个位置加上关键字typename 告诉编译器这是个类型 不允许出现在成员初值列<br>eg:</p>
<pre><code>template&lt;typename C&gt;
void print2nd(const C&amp; container)
{
    if(container.size() &gt;= 2)
    {
        typename C::const_iterator iter(container.begin());
    }
}
</code></pre><p>(43) 处理模板化基类的名称</p>
<p>derived class temolates 对base classes的内容不了解，<br>可以通过this指向basic class template的成员变量 或使用using 或使用域名修饰符 base::method</p>
<p>(44)将参数无关的代码抽离template<br>共性与变性分析</p>
<p>代码膨胀 相同模板 产生两份代码</p>
<p>非类型参数造成的代码膨胀 以函数参数或class成员变量替换template参数</p>
<p>类型参数造成的代码膨胀 带有完全相同二进制表述的具现类型共享实现码。</p>
<p>(45)运用成员函数模板接受所有兼容类型</p>
<p>泛型编程<br>Top 基类 Middle继承Top Bottom继承Middle<br>希望实现 根据一个SmartPtr<middle>或一个SmartPtr<bottom>构造出一个SmartPtr<top><br>eg:</top></bottom></middle></p>
<pre><code>template&lt;typename T&gt;
class SmartPtr{
public:
    template&lt;typename U&gt;
    SmartPtr(const SmartPtr&lt;U&gt;&amp; other):heldPtr(other.get());
    T* get() const {return heldPtr;}
private:
    T *heldPtr; 
}
</code></pre><p>如果你声明member templates 用于泛化copy构造或泛化assignment操作 你还需要声明正常的copy构造函数和assignment操作符</p>
<p>eg:</p>
<pre><code>template&lt;class T&gt;
class shared_ptr{
public:
    shared_ptr(const shared_ptr&amp; r);
    template&lt;class Y&gt;
    shared_ptr(const shared_ptr&lt;Y&gt;&amp; r);
    shared_ptr&amp; operator=(shared_ptr const&amp; r);
    template&lt;class Y&gt;
    shared_ptr operator=(const shared_ptr&lt;Y&gt;&amp; r);
}
</code></pre><p>(46) 编写一个class template 它所提供的以template相关的函数支持“所有参数之隐式类型转换” ，请将函数定义为 clas template内部的friend函数</p>
<p>eg:</p>
<pre><code>template&lt;typename T&gt; class Rational;
template&lt;typename T&gt; doMultiply(const Rational&lt;T&gt;&amp; lhs, const Rational&lt;T&gt;&amp; rhs)
{
    return Rational&lt;T&gt;(lhs.numerator()*rhs.numerator(), lhs.denominator()*rhs.denominator());
}

template&lt;typename T&gt;
class Rational
{
public:
    friend const Rational&lt;T&gt; operator*(const Rational&lt;T&gt;&amp; lhs, Rational&lt;T&gt;&amp; rhs)
    {
        return doMultiply(lhs, rhs);
    }
}
</code></pre><p>(47) traits class 表现类型信息</p>
<pre><code>std::iterator_traits&lt;IterT&gt;::value_type tmp 
</code></pre><p>类型为IterT之对象所指mp之物的类型 如果IterT为vector<int>::iteratro 则tmp为int</int></p>
<p>traits classes用以提供类型信息，如迭代器类型iterator_traits(如random_access_iterator_tag,bidirectional_iterator_tag,input_iterator_tag)</p>
<p>trait classes 使得类型相关信息在编译期可用</p>
<p>整合重载技术 根据不同类型信息 进行相关操作</p>
<p>(48) 元编程<br>template metaprogramming(TMP, 模板元编程) 是编写template-based C++ 程序并执行于编译期的过程。</p>
<p>TMP将工作由运行期转移编译期 得以实现早期错误侦测和更高的执行效率</p>
<p>一个通过递归模板具现化实现接触的TMP程序：</p>
<pre><code>template&lt;unsigned n&gt;
struct Factorial{
    enum {value = n * Factorial&lt;n-1&gt;::value};
}

template&lt;&gt;
struct Factorial&lt;0&gt;{
    enum{ value = 1 };
}
</code></pre><h2 id="定制new和delete"><a href="#定制new和delete" class="headerlink" title="定制new和delete"></a>定制new和delete</h2><p>(49) 了解new-handler的行为</p>
<p>当 operator new抛出异常 它会调用一个客户制定的错误处理程序 就是new-handler</p>
<p>设计一个良好的new-handler: 让更多内存可被使用 安装另一个new-handler 卸载new-handler 抛出bad_alloc 不返回</p>
<p>operator new 执行过程：</p>
<p><img src="/images/effective-c/new-handler.png" alt=""></p>
<p>nothrow new 只适用于内存分配 后继的构造函数调用还是可能抛出异常。</p>
<p>(50) 了解new和delete合理替换时机</p>
<p>new得到的内存 没有delete 造成内存泄露<br>new得到的内存 多次delete 导致不确定行为</p>
<p>定制 new和delete 改善性能 对heap错误进行调试 收集heap使用信息</p>
<p>(51) 编写new和delete 固守常规</p>
<p>operator new 应该包含一个无穷循环 如果它无法满足内存需求 就调用new-handler 。另外 它应该有能力处理0 bytes申请。Class专属版本应该处理“比正确大小更大（错误）申请”</p>
<p>operator delete应该在收到null指针时不做任何事情，Class专属版本应该处理“比正确大小更大（错误）申请”。</p>
<p>(52) placement new placement delete<br>placement new 意味着额外参数的new</p>
<p>使用placement new</p>
<pre><code>Widget *pw  = new (std::cerr)Widget;
</code></pre><p>在构造函数时发生异常 若没有相应的placement delete 则会造成内存泄露</p>
<p>写一个placement operator new 应该确定对应的placement operator delete</p>
<p>声明placement new和placement delete 请不要无意识遮掩它们的正常版本。可以使用using 或 base clas中包含所有正常形式的new和delete</p>
<h2 id="杂项讨论"><a href="#杂项讨论" class="headerlink" title="杂项讨论"></a>杂项讨论</h2><p>(53) 不要忽视编译器的警告</p>
<p>(54) 熟悉标准程序库</p>
<p>(55) 熟悉 boost</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/effective-c/" rel="tag"># effective_c</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/07/json-parse/" rel="next" title="json解析器">
                <i class="fa fa-chevron-left"></i> json解析器
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/10/stl/" rel="prev" title="stl源码剖析">
                stl源码剖析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zz_wang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#理解C＋＋"><span class="nav-number">1.</span> <span class="nav-text">理解Ｃ＋＋</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构造-析构-赋值运算"><span class="nav-number">2.</span> <span class="nav-text">构造　析构　赋值运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#资源管理"><span class="nav-number">3.</span> <span class="nav-text">资源管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设计与声明"><span class="nav-number">4.</span> <span class="nav-text">设计与声明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现"><span class="nav-number">5.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#继承与面向对象设计"><span class="nav-number">6.</span> <span class="nav-text">继承与面向对象设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定制new和delete"><span class="nav-number">7.</span> <span class="nav-text">定制new和delete</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#杂项讨论"><span class="nav-number">8.</span> <span class="nav-text">杂项讨论</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zz_wang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
